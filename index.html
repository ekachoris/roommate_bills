<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auburn Roommate Bills</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0C2340 0%, #E87722 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: #0C2340;
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header .subtitle {
            color: #E87722;
            font-size: 1.2em;
            font-weight: bold;
        }

        .main-content {
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 3px solid #E87722;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #0C2340;
            border: none;
            background: #f5f5f5;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #E87722;
            border-bottom: 3px solid #E87722;
            margin-bottom: -3px;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #0C2340;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #E87722;
        }

        .btn {
            background: #E87722;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: #d66a1a;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(232, 119, 34, 0.3);
        }

        .btn-secondary {
            background: #0C2340;
        }

        .btn-secondary:hover {
            background: #081829;
        }

        .expense-list {
            margin-top: 30px;
        }

        .expense-item {
            background: #f9f9f9;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid #E87722;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-details h3 {
            color: #0C2340;
            margin-bottom: 5px;
        }

        .expense-details p {
            color: #666;
            margin: 3px 0;
        }

        .expense-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #E87722;
        }

        .settlement-box {
            background: #f0f8ff;
            border: 3px solid #0C2340;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .settlement-item {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #E87722;
            font-size: 1.1em;
        }

        .settlement-item strong {
            color: #0C2340;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #0C2340 0%, #1a3a5c 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #E87722;
        }

        .month-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .month-selector select {
            flex: 1;
            min-width: 150px;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .roommate-chip {
            display: inline-block;
            background: #E87722;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 5px;
            font-weight: bold;
        }

        .roommate-chip button {
            background: none;
            border: none;
            color: white;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
        }

        .roommate-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group input {
            flex: 1;
        }

        .input-group button {
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .expense-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .expense-amount {
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü¶Ö War Eagle Bills ü¶Ö</h1>
            <div class="subtitle">Auburn Roommate Expense Tracker</div>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('roommates')">Roommates</button>
                <button class="tab" onclick="switchTab('add')">Add Expense</button>
                <button class="tab" onclick="switchTab('settle')">Settle Up</button>
                <button class="tab" onclick="switchTab('history')">History & Analytics</button>
            </div>

            <!-- Roommates Tab -->
            <div id="roommates-tab" class="tab-content active">
                <h2 style="color: #0C2340; margin-bottom: 25px;">üè† Manage Roommates</h2>
                
                <p style="margin-bottom: 20px; color: #666;">
                    Add all roommates who live in the apartment. Bills will be split equally among all roommates, 
                    even if someone didn't pay any bills that month.
                </p>

                <div class="input-group">
                    <input type="text" id="newRoommateName" placeholder="Enter roommate name">
                    <button class="btn" onclick="addRoommate()">Add Roommate</button>
                </div>

                <div id="roommatesList" class="roommate-list"></div>

                <div style="margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 10px; border-left: 5px solid #E87722;">
                    <h3 style="color: #0C2340; margin-bottom: 10px;">üí° Quick Tip</h3>
                    <p style="color: #666;">
                        Add all your roommates here first. When you add expenses, just select who paid from the dropdown. 
                        At month's end, the settlement will divide the total equally among ALL roommates listed here.
                    </p>
                </div>
            </div>

            <!-- Add Expense Tab -->
            <div id="add-tab" class="tab-content">
                <h2 style="color: #0C2340; margin-bottom: 25px;">Add New Expense</h2>
                
                <div class="form-group">
                    <label>Roommate Who Paid</label>
                    <select id="roommateName">
                        <option value="">Select roommate...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Expense Description</label>
                    <input type="text" id="expenseDescription" placeholder="e.g., Electricity Bill, Groceries, Internet">
                </div>

                <div class="form-group">
                    <label>Amount ($)</label>
                    <input type="number" id="expenseAmount" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label>Month</label>
                    <select id="expenseMonth">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Year</label>
                    <select id="expenseYear"></select>
                </div>

                <button class="btn" onclick="addExpense()">Add Expense</button>

                <div class="expense-list" id="currentExpenses"></div>
            </div>

            <!-- Settle Up Tab -->
            <div id="settle-tab" class="tab-content">
                <h2 style="color: #0C2340; margin-bottom: 25px;">Settlement Calculator</h2>
                
                <div class="month-selector">
                    <select id="settleMonth">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <select id="settleYear"></select>
                    <button class="btn" onclick="calculateSettlement()">Calculate Settlement</button>
                </div>

                <div id="settlementResults"></div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-content">
                <h2 style="color: #0C2340; margin-bottom: 25px;">Annual Analytics</h2>
                
                <div class="form-group">
                    <label>Select Year</label>
                    <select id="analyticsYear" onchange="loadAnalytics()"></select>
                </div>

                <div class="stats-grid" id="statsGrid"></div>

                <div id="monthlyBreakdown"></div>
            </div>
        </div>
    </div>

    <script>
        // Get roommates from localStorage
        function getRoommates() {
            const roommates = localStorage.getItem('auburnRoommates');
            return roommates ? JSON.parse(roommates) : [];
        }

        // Save roommates to localStorage
        function saveRoommates(roommates) {
            localStorage.setItem('auburnRoommates', JSON.stringify(roommates));
        }

        // Add new roommate
        function addRoommate() {
            const name = document.getElementById('newRoommateName').value.trim();
            
            if (!name) {
                alert('Please enter a roommate name');
                return;
            }

            const roommates = getRoommates();
            
            if (roommates.includes(name)) {
                alert('This roommate is already added');
                return;
            }

            roommates.push(name);
            saveRoommates(roommates);
            document.getElementById('newRoommateName').value = '';
            loadRoommates();
            updateRoommateDropdown();
            alert('Roommate added! War Eagle! ü¶Ö');
        }

        // Remove roommate
        function removeRoommate(name) {
            if (!confirm(`Remove ${name} from the apartment?`)) return;
            
            const roommates = getRoommates().filter(r => r !== name);
            saveRoommates(roommates);
            loadRoommates();
            updateRoommateDropdown();
        }

        // Load and display roommates
        function loadRoommates() {
            const roommates = getRoommates();
            const container = document.getElementById('roommatesList');
            
            if (roommates.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No roommates added yet. Add your first roommate above!</p></div>';
                return;
            }

            container.innerHTML = '<h3 style="color: #0C2340; margin-bottom: 15px;">Current Roommates (' + roommates.length + ')</h3>' +
                roommates.map(name => `
                    <div class="roommate-chip">
                        ${name}
                        <button onclick="removeRoommate('${name}')" title="Remove">√ó</button>
                    </div>
                `).join('');
        }

        // Update roommate dropdown in Add Expense form
        function updateRoommateDropdown() {
            const roommates = getRoommates();
            const select = document.getElementById('roommateName');
            
            select.innerHTML = '<option value="">Select roommate...</option>' +
                roommates.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        // Initialize year selectors
        function initializeYears() {
            const currentYear = new Date().getFullYear();
            const years = [currentYear - 1, currentYear, currentYear + 1];
            
            const selectors = ['expenseYear', 'settleYear', 'analyticsYear'];
            selectors.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = years.map(year => 
                    `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}</option>`
                ).join('');
            });
        }

        // Initialize current month
        function initializeCurrentMonth() {
            const currentMonth = String(new Date().getMonth() + 1).padStart(2, '0');
            document.getElementById('expenseMonth').value = currentMonth;
            document.getElementById('settleMonth').value = currentMonth;
        }

        // Get expenses from localStorage
        function getExpenses() {
            const expenses = localStorage.getItem('auburnRoommateExpenses');
            return expenses ? JSON.parse(expenses) : [];
        }

        // Save expenses to localStorage
        function saveExpenses(expenses) {
            localStorage.setItem('auburnRoommateExpenses', JSON.stringify(expenses));
        }

        // Add new expense
        function addExpense() {
            const name = document.getElementById('roommateName').value;
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const month = document.getElementById('expenseMonth').value;
            const year = document.getElementById('expenseYear').value;

            if (!name) {
                alert('Please select which roommate paid');
                return;
            }

            if (!description || !amount || amount <= 0) {
                alert('Please fill in all fields with valid values');
                return;
            }

            const expenses = getExpenses();
            expenses.push({
                id: Date.now(),
                name,
                description,
                amount,
                month,
                year,
                date: new Date().toISOString()
            });

            saveExpenses(expenses);

            // Clear form
            document.getElementById('roommateName').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';

            alert('Expense added successfully! War Eagle! ü¶Ö');
            loadCurrentExpenses();
        }

        // Load current month expenses
        function loadCurrentExpenses() {
            const month = document.getElementById('expenseMonth').value;
            const year = document.getElementById('expenseYear').value;
            const expenses = getExpenses().filter(e => e.month === month && e.year === year);

            const container = document.getElementById('currentExpenses');
            
            if (expenses.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No expenses for this month yet</p></div>';
                return;
            }

            container.innerHTML = '<h3 style="color: #0C2340; margin-top: 30px;">Current Month Expenses</h3>' +
                expenses.map(exp => `
                    <div class="expense-item">
                        <div class="expense-details">
                            <h3>${exp.description}</h3>
                            <p>Paid by: ${exp.name}</p>
                            <p>${new Date(exp.date).toLocaleDateString()}</p>
                        </div>
                        <div>
                            <div class="expense-amount">$${exp.amount.toFixed(2)}</div>
                            <button class="delete-btn" onclick="deleteExpense(${exp.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
        }

        // Delete expense
        function deleteExpense(id) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expenses = getExpenses().filter(e => e.id !== id);
            saveExpenses(expenses);
            loadCurrentExpenses();
        }

        // Calculate settlement using greedy algorithm
        function calculateSettlement() {
            const month = document.getElementById('settleMonth').value;
            const year = document.getElementById('settleYear').value;
            const expenses = getExpenses().filter(e => e.month === month && e.year === year);
            const allRoommates = getRoommates();

            const resultsDiv = document.getElementById('settlementResults');

            if (allRoommates.length === 0) {
                resultsDiv.innerHTML = '<div class="empty-state"><p>Please add roommates first in the Roommates tab</p></div>';
                return;
            }

            if (expenses.length === 0) {
                resultsDiv.innerHTML = '<div class="empty-state"><p>No expenses found for this month</p></div>';
                return;
            }

            // Calculate balances - initialize ALL roommates with 0
            const balances = {};
            allRoommates.forEach(roommate => {
                balances[roommate] = 0;
            });

            let totalExpenses = 0;

            expenses.forEach(exp => {
                balances[exp.name] += exp.amount;
                totalExpenses += exp.amount;
            });

            // Split equally among ALL roommates (not just those who paid)
            const numPeople = allRoommates.length;
            const perPersonShare = totalExpenses / numPeople;

            // Calculate net balance (positive = owed money, negative = owes money)
            const netBalances = {};
            allRoommates.forEach(person => {
                netBalances[person] = balances[person] - perPersonShare;
            });

            // Separate creditors and debtors
            const creditors = [];
            const debtors = [];

            Object.entries(netBalances).forEach(([person, balance]) => {
                if (balance > 0.01) {
                    creditors.push({ person, amount: balance });
                } else if (balance < -0.01) {
                    debtors.push({ person, amount: -balance });
                }
            });

            // Sort by amount
            creditors.sort((a, b) => b.amount - a.amount);
            debtors.sort((a, b) => b.amount - a.amount);

            // Calculate minimum transactions
            const transactions = [];
            let i = 0, j = 0;

            while (i < creditors.length && j < debtors.length) {
                const creditor = creditors[i];
                const debtor = debtors[j];
                const amount = Math.min(creditor.amount, debtor.amount);

                transactions.push({
                    from: debtor.person,
                    to: creditor.person,
                    amount: amount
                });

                creditor.amount -= amount;
                debtor.amount -= amount;

                if (creditor.amount < 0.01) i++;
                if (debtor.amount < 0.01) j++;
            }

            // Display results
            let html = '<div class="settlement-box">';
            html += '<h3 style="color: #0C2340; margin-bottom: 20px;">üí∞ Settlement Summary</h3>';
            html += `<p style="font-size: 1.1em; margin-bottom: 10px;">Total Expenses: <strong style="color: #E87722;">$${totalExpenses.toFixed(2)}</strong></p>`;
            html += `<p style="font-size: 1.1em; margin-bottom: 10px;">Number of Roommates: <strong style="color: #E87722;">${numPeople}</strong></p>`;
            html += `<p style="font-size: 1.1em; margin-bottom: 20px;">Per Person Share: <strong style="color: #E87722;">$${perPersonShare.toFixed(2)}</strong></p>`;
            html += '<h4 style="color: #0C2340; margin: 20px 0;">Required Payments:</h4>';

            if (transactions.length === 0) {
                html += '<p style="text-align: center; color: #28a745; font-weight: bold; font-size: 1.2em;">‚úì All settled up! Everyone is even.</p>';
            } else {
                transactions.forEach(t => {
                    html += `
                        <div class="settlement-item">
                            <strong>${t.from}</strong> pays <strong>${t.to}</strong>: 
                            <span style="color: #E87722; font-weight: bold; font-size: 1.2em;">$${t.amount.toFixed(2)}</span>
                        </div>
                    `;
                });
            }

            html += '</div>';

            // Individual breakdown - show ALL roommates
            html += '<h3 style="color: #0C2340; margin: 30px 0 20px 0;">Individual Breakdown</h3>';
            allRoommates.forEach(person => {
                const paid = balances[person];
                const net = netBalances[person];
                const status = net > 0.01 ? `Gets back $${net.toFixed(2)}` : 
                              net < -0.01 ? `Owes $${(-net).toFixed(2)}` : 
                              'All settled';
                const color = net > 0.01 ? '#28a745' : net < -0.01 ? '#dc3545' : '#6c757d';
                
                html += `
                    <div class="expense-item">
                        <div class="expense-details">
                            <h3>${person}</h3>
                            <p>Paid: $${paid.toFixed(2)}</p>
                            <p style="color: ${color}; font-weight: bold;">${status}</p>
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // Load analytics
        function loadAnalytics() {
            const year = document.getElementById('analyticsYear').value;
            const expenses = getExpenses().filter(e => e.year === year);

            if (expenses.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<div class="empty-state"><p>No expenses recorded for this year</p></div>';
                document.getElementById('monthlyBreakdown').innerHTML = '';
                return;
            }

            // Calculate stats
            const totalAmount = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const uniqueRoommates = [...new Set(expenses.map(e => e.name))];
            const avgPerMonth = totalAmount / 12;

            // Most expensive category
            const categoryTotals = {};
            expenses.forEach(exp => {
                if (!categoryTotals[exp.description]) categoryTotals[exp.description] = 0;
                categoryTotals[exp.description] += exp.amount;
            });
            const topCategory = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0];

            // Display stats
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <h3>Total Expenses</h3>
                    <div class="value">$${totalAmount.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Roommates</h3>
                    <div class="value">${uniqueRoommates.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Per Month</h3>
                    <div class="value">$${avgPerMonth.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Total Transactions</h3>
                    <div class="value">${expenses.length}</div>
                </div>
            `;

            // Monthly breakdown
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyData = {};
            
            for (let i = 1; i <= 12; i++) {
                const month = String(i).padStart(2, '0');
                const monthExpenses = expenses.filter(e => e.month === month);
                const total = monthExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                monthlyData[month] = { total, count: monthExpenses.length };
            }

            let breakdownHtml = '<h3 style="color: #0C2340; margin: 30px 0 20px 0;">Monthly Breakdown</h3>';
            Object.entries(monthlyData).forEach(([month, data]) => {
                if (data.count > 0) {
                    breakdownHtml += `
                        <div class="expense-item">
                            <div class="expense-details">
                                <h3>${monthNames[parseInt(month) - 1]} ${year}</h3>
                                <p>${data.count} transactions</p>
                            </div>
                            <div class="expense-amount">$${data.total.toFixed(2)}</div>
                        </div>
                    `;
                }
            });

            document.getElementById('monthlyBreakdown').innerHTML = breakdownHtml;
        }

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');

            // Load appropriate data
            if (tabName === 'roommates') {
                loadRoommates();
            } else if (tabName === 'add') {
                loadCurrentExpenses();
                updateRoommateDropdown();
            } else if (tabName === 'history') {
                loadAnalytics();
            }
        }

        // Initialize on page load
        window.onload = function() {
            initializeYears();
            initializeCurrentMonth();
            loadRoommates();
            updateRoommateDropdown();
            loadCurrentExpenses();
        };
    </script>
</body>
</html>
