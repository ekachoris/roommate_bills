<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roommate Bills</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            border-radius: 15px 15px 0 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header .subtitle {
            color: #3498db;
            font-size: 1.2em;
            font-weight: bold;
        }

        .main-content {
            background: white;
            border-radius: 0 0 15px 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 3px solid #3498db;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 150px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            color: #2c3e50;
            border: none;
            background: #f5f5f5;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #3498db;
            border-bottom: 3px solid #3498db;
            margin-bottom: -3px;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        /* Touch-friendly improvements */
        button, .tab, .roommate-chip button {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        /* Prevent text selection on buttons */
        .btn, .tab, .delete-btn, .logout-btn {
            user-select: none;
            -webkit-user-select: none;
        }

        /* Better scrolling on mobile */
        .tabs {
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        .tabs::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #2c3e50;
        }

        .btn-secondary:hover {
            background: #1a252f;
        }

        .expense-list {
            margin-top: 30px;
        }

        .expense-item {
            background: #f9f9f9;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .expense-details h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .expense-details p {
            color: #666;
            margin: 3px 0;
        }

        .expense-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
        }

        .settlement-box {
            background: #f0f8ff;
            border: 3px solid #2c3e50;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .settlement-item {
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
            border-left: 5px solid #3498db;
            font-size: 1.1em;
        }

        .settlement-item strong {
            color: #2c3e50;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9em;
            margin-bottom: 10px;
            opacity: 0.9;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }

        .month-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .month-selector select {
            flex: 1;
            min-width: 150px;
        }

        .delete-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 50px;
            color: #999;
        }

        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
        }

        .roommate-chip {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin: 5px;
            font-weight: bold;
        }

        .roommate-chip button {
            background: none;
            border: none;
            color: white;
            margin-left: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
        }

        .roommate-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .input-group input {
            flex: 1;
        }

        .input-group button {
            flex-shrink: 0;
        }

        .login-container {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .login-container h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-container p {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
        }

        .logout-btn:hover {
            background: #c82333;
        }

        .home-btn {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
            margin-right: 10px;
        }

        .home-btn:hover {
            background: #218838;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        @media (min-width: 769px) {
            .header-buttons {
                position: absolute;
                top: 30px;
                right: 30px;
            }

            .logout-btn, .home-btn {
                margin-top: 0;
            }

            .home-btn {
                margin-right: 10px;
            }

            .header {
                position: relative;
            }
        }

        .apartment-info {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            border-left: 5px solid #3498db;
        }

        .apartment-info strong {
            color: #2c3e50;
            font-size: 1.2em;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.5em;
                letter-spacing: 1px;
            }

            .header .subtitle {
                font-size: 0.9em;
            }

            .header {
                padding: 20px 15px;
            }

            .logout-btn {
                padding: 8px 15px;
                font-size: 0.9em;
                position: static;
                float: none;
                margin: 0;
                display: block;
                width: 100%;
                max-width: 150px;
            }

            .home-btn {
                padding: 8px 15px;
                font-size: 0.9em;
                margin: 0;
                width: 100%;
                max-width: 150px;
            }

            .header-buttons {
                margin-top: 15px;
            }
            
            .tabs {
                flex-direction: row;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                min-width: 120px;
                padding: 15px 10px;
                font-size: 0.95em;
                flex: 0 0 auto;
            }
            
            .tab-content {
                padding: 20px 15px;
            }

            .login-container {
                padding: 25px 20px;
                margin: 20px auto;
            }

            .login-container h2 {
                font-size: 1.5em;
            }

            input, select, textarea {
                font-size: 16px; /* Prevents iOS zoom on focus */
            }

            .btn {
                width: 100%;
                padding: 12px 20px;
                font-size: 1em;
            }

            .input-group {
                flex-direction: column;
            }

            .input-group button {
                width: 100%;
                margin-top: 10px;
            }
            
            .expense-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 15px;
            }
            
            .expense-amount {
                margin-top: 10px;
                font-size: 1.3em;
            }

            .expense-details h3 {
                font-size: 1.1em;
            }

            .delete-btn {
                margin-top: 10px;
                width: 100%;
            }

            .settlement-box {
                padding: 15px;
            }

            .settlement-item {
                padding: 12px;
                font-size: 1em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .stat-card {
                padding: 20px;
            }

            .month-selector {
                flex-direction: column;
            }

            .month-selector select,
            .month-selector button {
                width: 100%;
            }

            .roommate-chip {
                padding: 8px 15px;
                font-size: 0.95em;
            }

            .apartment-info {
                padding: 12px;
                font-size: 0.95em;
            }

            h2 {
                font-size: 1.5em;
            }

            h3 {
                font-size: 1.2em;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.2em;
            }

            .header .subtitle {
                font-size: 0.8em;
            }

            .tab {
                min-width: 100px;
                padding: 12px 8px;
                font-size: 0.85em;
            }

            .stat-card .value {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="container" style="display: none;">
        <div class="header">
            <h1>üéì Roommate Bills üéì</h1>
            <div class="subtitle">College Roommate Expense Tracker</div>
        </div>
        <div class="login-container">
            <h2>Apartment Login</h2>
            <p>Select your school and enter your apartment information</p>
            <div class="login-form">
                <div class="form-group">
                    <label>Select Your School</label>
                    <select id="schoolSelect" onchange="previewSchool()">
                        <option value="">Choose your school...</option>
                        <optgroup label="SEC Schools">
                            <option value="alabama">Alabama - Roll Tide üêò</option>
                            <option value="arkansas">Arkansas - Woo Pig Sooie üêó</option>
                            <option value="auburn">Auburn - War Eagle ü¶Ö</option>
                            <option value="florida">Florida - Go Gators üêä</option>
                            <option value="georgia">Georgia - Go Dawgs üê∂</option>
                            <option value="kentucky">Kentucky - Go Cats üê±</option>
                            <option value="lsu">LSU - Geaux Tigers üêØ</option>
                            <option value="mississippi_state">Mississippi State - Hail State üîî</option>
                            <option value="missouri">Missouri - M-I-Z üêØ</option>
                            <option value="oklahoma">Oklahoma - Boomer Sooner üèá</option>
                            <option value="ole_miss">Ole Miss - Hotty Toddy ü¶à</option>
                            <option value="south_carolina">South Carolina - Go Gamecocks üêì</option>
                            <option value="tennessee">Tennessee - Go Vols üêæ</option>
                            <option value="texas">Texas - Hook 'em ü§ò</option>
                            <option value="texas_am">Texas A&M - Gig 'Em üêï</option>
                            <option value="vanderbilt">Vanderbilt - Anchor Down ‚öì</option>
                        </optgroup>
                        <optgroup label="Big 12 Schools">
                            <option value="arizona">Arizona - Bear Down üêª</option>
                            <option value="arizona_state">Arizona State - Go Devils üòà</option>
                            <option value="baylor">Baylor - Sic 'em üêª</option>
                            <option value="byu">BYU - Go Cougs ü¶Å</option>
                            <option value="cincinnati">Cincinnati - Go Bearcats üêæ</option>
                            <option value="colorado">Colorado - Go Buffs ü¶¨</option>
                            <option value="houston">Houston - Go Coogs üêæ</option>
                            <option value="iowa_state">Iowa State - Go Cyclones üå™Ô∏è</option>
                            <option value="kansas">Kansas - Rock Chalk ü¶Ö</option>
                            <option value="kansas_state">Kansas State - Go Cats üê±</option>
                            <option value="oklahoma_state">Oklahoma State - Go Pokes ü§†</option>
                            <option value="tcu">TCU - Go Frogs üê∏</option>
                            <option value="texas_tech">Texas Tech - Wreck 'Em üî´</option>
                            <option value="ucf">UCF - Charge On ‚öîÔ∏è</option>
                            <option value="utah">Utah - Go Utes ü¶Ö</option>
                            <option value="west_virginia">West Virginia - Let's Go ‚õ∞Ô∏è</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-group">
                    <label>Apartment Name</label>
                    <input type="text" id="loginApartmentName" placeholder="e.g., Eagle's Nest, 123 Main St">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter apartment password">
                </div>
                <button class="btn" onclick="login()">Access Apartment</button>
            </div>
            <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-radius: 10px; border-left: 5px solid #3498db;">
                <h3 style="color: #2c3e50; margin-bottom: 10px;">üîí First Time Setup</h3>
                <p style="color: #666; margin: 0;">
                    Choose any apartment name and password. This will create your apartment's data space. 
                    Share these credentials with your roommates so everyone can access the same data.
                </p>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <div>
                <h1>üéì Roommate Bills üéì</h1>
                <div class="subtitle">College Roommate Expense Tracker</div>
            </div>
            <div class="header-buttons">
                <button class="home-btn" onclick="goHome()">Home</button>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="main-content">
            <div class="apartment-info">
                <strong id="currentApartmentName"></strong>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="switchTab('roommates')">Roommates</button>
                <button class="tab" onclick="switchTab('add')">Add Expense</button>
                <button class="tab" onclick="switchTab('settle')">Settle Up</button>
                <button class="tab" onclick="switchTab('history')">History & Analytics</button>
            </div>

            <!-- Roommates Tab -->
            <div id="roommates-tab" class="tab-content active">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">üè† Manage Roommates</h2>
                
                <p style="margin-bottom: 20px; color: #666;">
                    Add all roommates who live in the apartment. Bills will be split equally among all roommates, 
                    even if someone didn't pay any bills that month.
                </p>

                <div class="input-group">
                    <input type="text" id="newRoommateName" placeholder="Enter roommate name">
                    <button class="btn" onclick="addRoommate()">Add Roommate</button>
                </div>

                <div id="roommatesList" class="roommate-list"></div>

                <div style="margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 10px; border-left: 5px solid #3498db;">
                    <h3 style="color: #2c3e50; margin-bottom: 10px;">üí° Quick Tip</h3>
                    <p style="color: #666;">
                        Add all your roommates here first. When you add expenses, just select who paid from the dropdown. 
                        At month's end, the settlement will divide the total equally among ALL roommates listed here.
                    </p>
                </div>
            </div>

            <!-- Add Expense Tab -->
            <div id="add-tab" class="tab-content">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">Add New Expense</h2>
                
                <div class="form-group">
                    <label>Roommate Who Paid</label>
                    <select id="roommateName">
                        <option value="">Select roommate...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Expense Description</label>
                    <input type="text" id="expenseDescription" placeholder="e.g., Electricity Bill, Groceries, Internet">
                </div>

                <div class="form-group">
                    <label>Amount ($)</label>
                    <input type="number" id="expenseAmount" step="0.01" placeholder="0.00">
                </div>

                <div class="form-group">
                    <label>Month</label>
                    <select id="expenseMonth" style="width: 100%;">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Year</label>
                    <select id="expenseYear" style="width: 100%;"></select>
                </div>

                <button class="btn" onclick="addExpense()">Add Expense</button>

                <div class="expense-list" id="currentExpenses"></div>
            </div>

            <!-- Settle Up Tab -->
            <div id="settle-tab" class="tab-content">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">Settlement Calculator</h2>
                
                <div class="month-selector">
                    <select id="settleMonth">
                        <option value="01">January</option>
                        <option value="02">February</option>
                        <option value="03">March</option>
                        <option value="04">April</option>
                        <option value="05">May</option>
                        <option value="06">June</option>
                        <option value="07">July</option>
                        <option value="08">August</option>
                        <option value="09">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <select id="settleYear"></select>
                    <button class="btn" onclick="calculateSettlement()">Calculate Settlement</button>
                </div>

                <div id="settlementResults"></div>
            </div>

            <!-- History Tab -->
            <div id="history-tab" class="tab-content">
                <h2 style="color: #2c3e50; margin-bottom: 25px;">Annual Analytics</h2>
                
                <div class="form-group">
                    <label>Select Year</label>
                    <select id="analyticsYear" onchange="loadAnalytics()"></select>
                </div>

                <div class="stats-grid" id="statsGrid"></div>

                <div id="monthlyBreakdown"></div>
            </div>
        </div>
    </div>

    <script>
        // School configurations with authentic branding
        const schools = {
            // SEC Schools
            auburn: {
                name: "Auburn University",
                shortName: "Auburn",
                primaryColor: "#0C2340",
                secondaryColor: "#E87722",
                mascot: "ü¶Ö",
                cheer: "War Eagle"
            },
            alabama: {
                name: "University of Alabama",
                shortName: "Alabama",
                primaryColor: "#9E1B32",
                secondaryColor: "#828A8F",
                mascot: "üêò",
                cheer: "Roll Tide"
            },
            georgia: {
                name: "University of Georgia",
                shortName: "Georgia",
                primaryColor: "#BA0C2F",
                secondaryColor: "#000000",
                mascot: "üê∂",
                cheer: "Go Dawgs"
            },
            florida: {
                name: "University of Florida",
                shortName: "Florida",
                primaryColor: "#0021A5",
                secondaryColor: "#FA4616",
                mascot: "üêä",
                cheer: "Go Gators"
            },
            lsu: {
                name: "Louisiana State University",
                shortName: "LSU",
                primaryColor: "#461D7C",
                secondaryColor: "#FDD023",
                mascot: "üêØ",
                cheer: "Geaux Tigers"
            },
            tennessee: {
                name: "University of Tennessee",
                shortName: "Tennessee",
                primaryColor: "#FF8200",
                secondaryColor: "#58595B",
                mascot: "üêæ",
                cheer: "Go Vols"
            },
            texas_am: {
                name: "Texas A&M University",
                shortName: "Texas A&M",
                primaryColor: "#500000",
                secondaryColor: "#FFFFFF",
                mascot: "üêï",
                cheer: "Gig 'Em"
            },
            missouri: {
                name: "University of Missouri",
                shortName: "Missouri",
                primaryColor: "#000000",
                secondaryColor: "#F1B82D",
                mascot: "üêØ",
                cheer: "M-I-Z"
            },
            arkansas: {
                name: "University of Arkansas",
                shortName: "Arkansas",
                primaryColor: "#9D2235",
                secondaryColor: "#FFFFFF",
                mascot: "üêó",
                cheer: "Woo Pig Sooie"
            },
            kentucky: {
                name: "University of Kentucky",
                shortName: "Kentucky",
                primaryColor: "#0033A0",
                secondaryColor: "#FFFFFF",
                mascot: "üê±",
                cheer: "Go Cats"
            },
            south_carolina: {
                name: "University of South Carolina",
                shortName: "South Carolina",
                primaryColor: "#73000A",
                secondaryColor: "#FFFFFF",
                mascot: "üêì",
                cheer: "Go Gamecocks"
            },
            vanderbilt: {
                name: "Vanderbilt University",
                shortName: "Vanderbilt",
                primaryColor: "#866D4B",
                secondaryColor: "#000000",
                mascot: "‚öì",
                cheer: "Anchor Down"
            },
            ole_miss: {
                name: "University of Mississippi",
                shortName: "Ole Miss",
                primaryColor: "#CE1126",
                secondaryColor: "#14213D",
                mascot: "ü¶à",
                cheer: "Hotty Toddy"
            },
            mississippi_state: {
                name: "Mississippi State University",
                shortName: "Mississippi State",
                primaryColor: "#5D1725",
                secondaryColor: "#FFFFFF",
                mascot: "üîî",
                cheer: "Hail State"
            },
            oklahoma: {
                name: "University of Oklahoma",
                shortName: "Oklahoma",
                primaryColor: "#841617",
                secondaryColor: "#FFF",
                mascot: "üèá",
                cheer: "Boomer Sooner"
            },
            texas: {
                name: "University of Texas",
                shortName: "Texas",
                primaryColor: "#BF5700",
                secondaryColor: "#FFFFFF",
                mascot: "ü§ò",
                cheer: "Hook 'em"
            },
            // Big 12 Schools
            kansas: {
                name: "University of Kansas",
                shortName: "Kansas",
                primaryColor: "#0051BA",
                secondaryColor: "#E8000D",
                mascot: "ü¶Ö",
                cheer: "Rock Chalk"
            },
            kansas_state: {
                name: "Kansas State University",
                shortName: "Kansas State",
                primaryColor: "#512888",
                secondaryColor: "#FFFFFF",
                mascot: "üê±",
                cheer: "Go Cats"
            },
            baylor: {
                name: "Baylor University",
                shortName: "Baylor",
                primaryColor: "#003015",
                secondaryColor: "#FFB81C",
                mascot: "üêª",
                cheer: "Sic 'em"
            },
            tcu: {
                name: "Texas Christian University",
                shortName: "TCU",
                primaryColor: "#4D1979",
                secondaryColor: "#FFFFFF",
                mascot: "üê∏",
                cheer: "Go Frogs"
            },
            texas_tech: {
                name: "Texas Tech University",
                shortName: "Texas Tech",
                primaryColor: "#CC0000",
                secondaryColor: "#000000",
                mascot: "üî´",
                cheer: "Wreck 'Em"
            },
            oklahoma_state: {
                name: "Oklahoma State University",
                shortName: "Oklahoma State",
                primaryColor: "#FF7300",
                secondaryColor: "#000000",
                mascot: "ü§†",
                cheer: "Go Pokes"
            },
            iowa_state: {
                name: "Iowa State University",
                shortName: "Iowa State",
                primaryColor: "#C8102E",
                secondaryColor: "#F1BE48",
                mascot: "üå™Ô∏è",
                cheer: "Go Cyclones"
            },
            west_virginia: {
                name: "West Virginia University",
                shortName: "West Virginia",
                primaryColor: "#002855",
                secondaryColor: "#EAAA00",
                mascot: "‚õ∞Ô∏è",
                cheer: "Let's Go"
            },
            cincinnati: {
                name: "University of Cincinnati",
                shortName: "Cincinnati",
                primaryColor: "#E00122",
                secondaryColor: "#000000",
                mascot: "üêæ",
                cheer: "Go Bearcats"
            },
            ucf: {
                name: "University of Central Florida",
                shortName: "UCF",
                primaryColor: "#000000",
                secondaryColor: "#FFC904",
                mascot: "‚öîÔ∏è",
                cheer: "Charge On"
            },
            byu: {
                name: "Brigham Young University",
                shortName: "BYU",
                primaryColor: "#002E5D",
                secondaryColor: "#FFFFFF",
                mascot: "ü¶Å",
                cheer: "Go Cougs"
            },
            houston: {
                name: "University of Houston",
                shortName: "Houston",
                primaryColor: "#C8102E",
                secondaryColor: "#FFFFFF",
                mascot: "üêæ",
                cheer: "Go Coogs"
            },
            arizona: {
                name: "University of Arizona",
                shortName: "Arizona",
                primaryColor: "#CC0033",
                secondaryColor: "#003366",
                mascot: "üêª",
                cheer: "Bear Down"
            },
            arizona_state: {
                name: "Arizona State University",
                shortName: "Arizona State",
                primaryColor: "#8C1D40",
                secondaryColor: "#FFC627",
                mascot: "üòà",
                cheer: "Go Devils"
            },
            colorado: {
                name: "University of Colorado",
                shortName: "Colorado",
                primaryColor: "#CFB87C",
                secondaryColor: "#000000",
                mascot: "ü¶¨",
                cheer: "Go Buffs"
            },
            utah: {
                name: "University of Utah",
                shortName: "Utah",
                primaryColor: "#CC0000",
                secondaryColor: "#FFFFFF",
                mascot: "ü¶Ö",
                cheer: "Go Utes"
            }
        };

        let currentSchool = null;
        // Current apartment session
        let currentApartment = null;

        // Get apartment key for localStorage
        function getApartmentKey(dataType) {
            if (!currentApartment) return null;
            return `auburn_${currentApartment.id}_${dataType}`;
        }

        // Simple hash function for apartment ID
        function hashApartmentId(apartmentName, password) {
            const combined = apartmentName.toLowerCase().trim() + '|' + password;
            let hash = 0;
            for (let i = 0; i < combined.length; i++) {
                const char = combined.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'apt_' + Math.abs(hash).toString(36);
        }

        // Preview school colors on login screen
        function previewSchool() {
            const schoolId = document.getElementById('schoolSelect').value;
            if (!schoolId) return;
            
            const school = schools[schoolId];
            const loginContainer = document.querySelector('.login-container');
            const btn = loginContainer.querySelector('.btn');
            
            // Update button colors
            btn.style.background = school.secondaryColor;
            btn.style.color = getContrastColor(school.secondaryColor);
        }

        // Get contrasting text color for background
        function getContrastColor(hexcolor) {
            // Convert hex to RGB
            const r = parseInt(hexcolor.slice(1, 3), 16);
            const g = parseInt(hexcolor.slice(3, 5), 16);
            const b = parseInt(hexcolor.slice(5, 7), 16);
            
            // Calculate luminance
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
        }

        // Apply school theme to entire app
        function applySchoolTheme(schoolId) {
            const school = schools[schoolId];
            currentSchool = school;
            
            const root = document.documentElement;
            
            // Create dynamic style element
            let styleEl = document.getElementById('dynamic-theme');
            if (!styleEl) {
                styleEl = document.createElement('style');
                styleEl.id = 'dynamic-theme';
                document.head.appendChild(styleEl);
            }
            
            const primaryContrast = getContrastColor(school.primaryColor);
            const secondaryContrast = getContrastColor(school.secondaryColor);
            
            styleEl.textContent = `
                body {
                    background: linear-gradient(135deg, ${school.primaryColor} 0%, ${school.secondaryColor} 100%);
                }
                .header {
                    background: ${school.primaryColor};
                    color: white !important;
                }
                .header h1 {
                    color: white !important;
                }
                .header .subtitle {
                    color: ${school.secondaryColor};
                }
                .tab.active {
                    color: ${school.secondaryColor};
                    border-bottom-color: ${school.secondaryColor};
                }
                .tabs {
                    border-bottom-color: ${school.secondaryColor};
                }
                .tab {
                    color: ${school.primaryColor};
                }
                .btn {
                    background: ${school.secondaryColor};
                    color: ${secondaryContrast};
                }
                .btn:hover {
                    background: ${school.secondaryColor}dd;
                }
                .btn-secondary {
                    background: ${school.primaryColor};
                    color: white;
                }
                .btn-secondary:hover {
                    background: ${school.primaryColor}dd;
                }
                .expense-item {
                    border-left-color: ${school.secondaryColor};
                }
                .expense-details h3 {
                    color: ${school.primaryColor} !important;
                }
                .expense-amount {
                    color: ${school.secondaryColor};
                }
                .settlement-box {
                    border-color: ${school.primaryColor};
                }
                .settlement-box h3, .settlement-box h4 {
                    color: ${school.primaryColor} !important;
                }
                .settlement-item {
                    border-left-color: ${school.secondaryColor};
                }
                .settlement-item strong {
                    color: ${school.primaryColor};
                }
                .settlement-item span {
                    color: ${school.secondaryColor};
                }
                .stat-card {
                    background: linear-gradient(135deg, ${school.primaryColor} 0%, ${school.primaryColor}cc 100%);
                    color: white !important;
                }
                .stat-card h3 {
                    color: white !important;
                }
                .stat-card .value {
                    color: ${school.secondaryColor};
                }
                .roommate-chip {
                    background: ${school.secondaryColor};
                    color: ${secondaryContrast};
                }
                .apartment-info {
                    border-left-color: ${school.secondaryColor};
                }
                .apartment-info strong {
                    color: ${school.primaryColor};
                }
                h2, h3, h4, label {
                    color: ${school.primaryColor} !important;
                }
                input:focus, select:focus, textarea:focus {
                    border-color: ${school.secondaryColor};
                }
            `;
            
            // Update header text with school-specific branding
            const headerTitle = document.querySelector('#mainApp .header h1');
            const headerSubtitle = document.querySelector('#mainApp .header .subtitle');
            
            if (headerTitle) {
                headerTitle.innerHTML = `${school.mascot} ${school.cheer} Bills ${school.mascot}`;
            }
            if (headerSubtitle) {
                headerSubtitle.textContent = `${school.name} Roommate Expense Tracker`;
            }
        }

        // Login function
        function login() {
            const schoolId = document.getElementById('schoolSelect').value;
            const apartmentName = document.getElementById('loginApartmentName').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!schoolId) {
                alert('Please select your school');
                return;
            }

            if (!apartmentName || !password) {
                alert('Please enter both apartment name and password');
                return;
            }

            // Create apartment session
            currentApartment = {
                name: apartmentName,
                id: hashApartmentId(apartmentName, password),
                school: schoolId
            };

            // Store session
            sessionStorage.setItem('currentApartment', JSON.stringify(currentApartment));

            // Apply school theme
            applySchoolTheme(schoolId);

            // Show main app
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('currentApartmentName').textContent = apartmentName;

            // Initialize app
            initializeApp();
        }

        // Logout function
        function logout() {
            if (!confirm('Are you sure you want to logout?')) return;
            
            sessionStorage.removeItem('currentApartment');
            currentApartment = null;
            currentSchool = null;
            
            // Clear form
            document.getElementById('schoolSelect').value = '';
            document.getElementById('loginApartmentName').value = '';
            document.getElementById('loginPassword').value = '';
            
            // Remove dynamic theme
            const styleEl = document.getElementById('dynamic-theme');
            if (styleEl) styleEl.remove();
            
            // Show login screen
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }

        // Go to home/login screen (without clearing session)
        function goHome() {
            // Show login screen
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
        }

        // Check if already logged in
        function checkSession() {
            const session = sessionStorage.getItem('currentApartment');
            if (session) {
                currentApartment = JSON.parse(session);
                applySchoolTheme(currentApartment.school);
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                document.getElementById('currentApartmentName').textContent = currentApartment.name;
                initializeApp();
            } else {
                document.getElementById('loginScreen').style.display = 'block';
            }
        }

        // Get roommates from localStorage
        function getRoommates() {
            const key = getApartmentKey('roommates');
            if (!key) return [];
            const roommates = localStorage.getItem(key);
            return roommates ? JSON.parse(roommates) : [];
        }

        // Save roommates to localStorage
        function saveRoommates(roommates) {
            const key = getApartmentKey('roommates');
            if (!key) return;
            localStorage.setItem(key, JSON.stringify(roommates));
        }

        // Add new roommate
        function addRoommate() {
            const name = document.getElementById('newRoommateName').value.trim();
            
            if (!name) {
                alert('Please enter a roommate name');
                return;
            }

            const roommates = getRoommates();
            
            if (roommates.includes(name)) {
                alert('This roommate is already added');
                return;
            }

            roommates.push(name);
            saveRoommates(roommates);
            document.getElementById('newRoommateName').value = '';
            loadRoommates();
            updateRoommateDropdown();
            alert('Roommate added successfully!');
        }

        // Remove roommate
        function removeRoommate(name) {
            if (!confirm(`Remove ${name} from the apartment?`)) return;
            
            const roommates = getRoommates().filter(r => r !== name);
            saveRoommates(roommates);
            loadRoommates();
            updateRoommateDropdown();
        }

        // Load and display roommates
        function loadRoommates() {
            const roommates = getRoommates();
            const container = document.getElementById('roommatesList');
            
            if (roommates.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No roommates added yet. Add your first roommate above!</p></div>';
                return;
            }

            container.innerHTML = '<h3 style="color: #2c3e50; margin-bottom: 15px;">Current Roommates (' + roommates.length + ')</h3>' +
                roommates.map(name => `
                    <div class="roommate-chip">
                        ${name}
                        <button onclick="removeRoommate('${name}')" title="Remove">√ó</button>
                    </div>
                `).join('');
        }

        // Update roommate dropdown in Add Expense form
        function updateRoommateDropdown() {
            const roommates = getRoommates();
            const select = document.getElementById('roommateName');
            
            select.innerHTML = '<option value="">Select roommate...</option>' +
                roommates.map(name => `<option value="${name}">${name}</option>`).join('');
        }

        // Initialize year selectors
        function initializeYears() {
            const currentYear = new Date().getFullYear();
            const years = [currentYear - 1, currentYear, currentYear + 1];
            
            const selectors = ['expenseYear', 'settleYear', 'analyticsYear'];
            selectors.forEach(id => {
                const select = document.getElementById(id);
                select.innerHTML = years.map(year => 
                    `<option value="${year}" ${year === currentYear ? 'selected' : ''}>${year}</option>`
                ).join('');
            });
        }

        // Initialize current month
        function initializeCurrentMonth() {
            const currentMonth = String(new Date().getMonth() + 1).padStart(2, '0');
            document.getElementById('expenseMonth').value = currentMonth;
            document.getElementById('settleMonth').value = currentMonth;
        }

        // Get expenses from localStorage
        function getExpenses() {
            const key = getApartmentKey('expenses');
            if (!key) return [];
            const expenses = localStorage.getItem(key);
            return expenses ? JSON.parse(expenses) : [];
        }

        // Save expenses to localStorage
        function saveExpenses(expenses) {
            const key = getApartmentKey('expenses');
            if (!key) return;
            localStorage.setItem(key, JSON.stringify(expenses));
        }

        // Add new expense
        function addExpense() {
            const name = document.getElementById('roommateName').value;
            const description = document.getElementById('expenseDescription').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const month = document.getElementById('expenseMonth').value;
            const year = document.getElementById('expenseYear').value;

            if (!name) {
                alert('Please select which roommate paid');
                return;
            }

            if (!description || !amount || amount <= 0) {
                alert('Please fill in all fields with valid values');
                return;
            }

            const expenses = getExpenses();
            expenses.push({
                id: Date.now(),
                name,
                description,
                amount,
                month,
                year,
                date: new Date().toISOString()
            });

            saveExpenses(expenses);

            // Clear form
            document.getElementById('roommateName').value = '';
            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';

            alert('Expense added successfully!');
            loadCurrentExpenses();
        }

        // Load current month expenses
        function loadCurrentExpenses() {
            const month = document.getElementById('expenseMonth').value;
            const year = document.getElementById('expenseYear').value;
            const expenses = getExpenses().filter(e => e.month === month && e.year === year);

            const container = document.getElementById('currentExpenses');
            
            if (expenses.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No expenses for this month yet</p></div>';
                return;
            }

            container.innerHTML = '<h3 style="color: #2c3e50; margin-top: 30px;">Current Month Expenses</h3>' +
                expenses.map(exp => `
                    <div class="expense-item">
                        <div class="expense-details">
                            <h3>${exp.description}</h3>
                            <p>Paid by: ${exp.name}</p>
                            <p>${new Date(exp.date).toLocaleDateString()}</p>
                        </div>
                        <div>
                            <div class="expense-amount">$${exp.amount.toFixed(2)}</div>
                            <button class="delete-btn" onclick="deleteExpense(${exp.id})">Delete</button>
                        </div>
                    </div>
                `).join('');
        }

        // Delete expense
        function deleteExpense(id) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expenses = getExpenses().filter(e => e.id !== id);
            saveExpenses(expenses);
            loadCurrentExpenses();
        }

        // Calculate settlement using greedy algorithm
        function calculateSettlement() {
            const month = document.getElementById('settleMonth').value;
            const year = document.getElementById('settleYear').value;
            const expenses = getExpenses().filter(e => e.month === month && e.year === year);
            const allRoommates = getRoommates();

            const resultsDiv = document.getElementById('settlementResults');

            if (allRoommates.length === 0) {
                resultsDiv.innerHTML = '<div class="empty-state"><p>Please add roommates first in the Roommates tab</p></div>';
                return;
            }

            if (expenses.length === 0) {
                resultsDiv.innerHTML = '<div class="empty-state"><p>No expenses found for this month</p></div>';
                return;
            }

            // Calculate balances - initialize ALL roommates with 0
            const balances = {};
            allRoommates.forEach(roommate => {
                balances[roommate] = 0;
            });

            let totalExpenses = 0;

            expenses.forEach(exp => {
                balances[exp.name] += exp.amount;
                totalExpenses += exp.amount;
            });

            // Split equally among ALL roommates (not just those who paid)
            const numPeople = allRoommates.length;
            const perPersonShare = totalExpenses / numPeople;

            // Calculate net balance (positive = owed money, negative = owes money)
            const netBalances = {};
            allRoommates.forEach(person => {
                netBalances[person] = balances[person] - perPersonShare;
            });

            // Separate creditors and debtors
            const creditors = [];
            const debtors = [];

            Object.entries(netBalances).forEach(([person, balance]) => {
                if (balance > 0.01) {
                    creditors.push({ person, amount: balance });
                } else if (balance < -0.01) {
                    debtors.push({ person, amount: -balance });
                }
            });

            // Sort by amount
            creditors.sort((a, b) => b.amount - a.amount);
            debtors.sort((a, b) => b.amount - a.amount);

            // Calculate minimum transactions
            const transactions = [];
            let i = 0, j = 0;

            while (i < creditors.length && j < debtors.length) {
                const creditor = creditors[i];
                const debtor = debtors[j];
                const amount = Math.min(creditor.amount, debtor.amount);

                transactions.push({
                    from: debtor.person,
                    to: creditor.person,
                    amount: amount
                });

                creditor.amount -= amount;
                debtor.amount -= amount;

                if (creditor.amount < 0.01) i++;
                if (debtor.amount < 0.01) j++;
            }

            // Display results
            let html = '<div class="settlement-box">';
            html += '<h3 style="color: #2c3e50; margin-bottom: 20px;">üí∞ Settlement Summary</h3>';
            html += `<p style="font-size: 1.1em; margin-bottom: 10px;">Total Expenses: <strong style="color: #3498db;">$${totalExpenses.toFixed(2)}</strong></p>`;
            html += `<p style="font-size: 1.1em; margin-bottom: 10px;">Number of Roommates: <strong style="color: #3498db;">${numPeople}</strong></p>`;
            html += `<p style="font-size: 1.1em; margin-bottom: 20px;">Per Person Share: <strong style="color: #3498db;">$${perPersonShare.toFixed(2)}</strong></p>`;
            html += '<h4 style="color: #2c3e50; margin: 20px 0;">Required Payments:</h4>';

            if (transactions.length === 0) {
                html += '<p style="text-align: center; color: #28a745; font-weight: bold; font-size: 1.2em;">‚úì All settled up! Everyone is even.</p>';
            } else {
                transactions.forEach(t => {
                    html += `
                        <div class="settlement-item">
                            <strong>${t.from}</strong> pays <strong>${t.to}</strong>: 
                            <span style="color: #3498db; font-weight: bold; font-size: 1.2em;">$${t.amount.toFixed(2)}</span>
                        </div>
                    `;
                });
            }

            html += '</div>';

            // Individual breakdown - show ALL roommates
            html += '<h3 style="color: #2c3e50; margin: 30px 0 20px 0;">Individual Breakdown</h3>';
            allRoommates.forEach(person => {
                const paid = balances[person];
                const net = netBalances[person];
                const status = net > 0.01 ? `Gets back $${net.toFixed(2)}` : 
                              net < -0.01 ? `Owes $${(-net).toFixed(2)}` : 
                              'All settled';
                const color = net > 0.01 ? '#28a745' : net < -0.01 ? '#dc3545' : '#6c757d';
                
                html += `
                    <div class="expense-item">
                        <div class="expense-details">
                            <h3>${person}</h3>
                            <p>Paid: $${paid.toFixed(2)}</p>
                            <p style="color: ${color}; font-weight: bold;">${status}</p>
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        // Load analytics
        function loadAnalytics() {
            const year = document.getElementById('analyticsYear').value;
            const expenses = getExpenses().filter(e => e.year === year);

            if (expenses.length === 0) {
                document.getElementById('statsGrid').innerHTML = '<div class="empty-state"><p>No expenses recorded for this year</p></div>';
                document.getElementById('monthlyBreakdown').innerHTML = '';
                return;
            }

            // Calculate stats
            const totalAmount = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const uniqueRoommates = [...new Set(expenses.map(e => e.name))];
            const avgPerMonth = totalAmount / 12;

            // Most expensive category
            const categoryTotals = {};
            expenses.forEach(exp => {
                if (!categoryTotals[exp.description]) categoryTotals[exp.description] = 0;
                categoryTotals[exp.description] += exp.amount;
            });
            const topCategory = Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0];

            // Display stats
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <h3>Total Expenses</h3>
                    <div class="value">$${totalAmount.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Roommates</h3>
                    <div class="value">${uniqueRoommates.length}</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Per Month</h3>
                    <div class="value">$${avgPerMonth.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <h3>Total Transactions</h3>
                    <div class="value">${expenses.length}</div>
                </div>
            `;

            // Monthly breakdown
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyData = {};
            
            for (let i = 1; i <= 12; i++) {
                const month = String(i).padStart(2, '0');
                const monthExpenses = expenses.filter(e => e.month === month);
                const total = monthExpenses.reduce((sum, exp) => sum + exp.amount, 0);
                monthlyData[month] = { total, count: monthExpenses.length };
            }

            let breakdownHtml = '<h3 style="color: #2c3e50; margin: 30px 0 20px 0;">Monthly Breakdown</h3>';
            Object.entries(monthlyData).forEach(([month, data]) => {
                if (data.count > 0) {
                    breakdownHtml += `
                        <div class="expense-item">
                            <div class="expense-details">
                                <h3>${monthNames[parseInt(month) - 1]} ${year}</h3>
                                <p>${data.count} transactions</p>
                            </div>
                            <div class="expense-amount">$${data.total.toFixed(2)}</div>
                        </div>
                    `;
                }
            });

            document.getElementById('monthlyBreakdown').innerHTML = breakdownHtml;
        }

        // Switch tabs
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');

            // Load appropriate data
            if (tabName === 'roommates') {
                loadRoommates();
            } else if (tabName === 'add') {
                loadCurrentExpenses();
                updateRoommateDropdown();
            } else if (tabName === 'history') {
                loadAnalytics();
            }
        }

        // Initialize the app after login
        function initializeApp() {
            initializeYears();
            initializeCurrentMonth();
            loadRoommates();
            updateRoommateDropdown();
            loadCurrentExpenses();
        }

        // Initialize on page load
        window.onload = function() {
            checkSession();
        };
    </script>
</body>
</html>
